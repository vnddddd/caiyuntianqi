<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>é›¨æ»´ç‰¹æ•ˆæµ‹è¯• - ä¼˜åŒ–å‰åå¯¹æ¯”</title>
    <style>
        body {
            margin: 0;
            padding: 0;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #2c3e50 0%, #34495e 100%);
            min-height: 100vh;
            color: white;
            overflow-x: hidden;
        }

        .container {
            display: flex;
            height: 100vh;
        }

        .test-panel {
            flex: 1;
            position: relative;
            border-right: 2px solid rgba(255, 255, 255, 0.2);
        }

        .test-panel:last-child {
            border-right: none;
        }

        .panel-header {
            position: absolute;
            top: 20px;
            left: 20px;
            right: 20px;
            z-index: 100;
            background: rgba(0, 0, 0, 0.7);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 20px;
        }

        .panel-title {
            font-size: 1.5em;
            font-weight: bold;
            margin-bottom: 10px;
        }

        .controls {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            margin-bottom: 15px;
        }

        button {
            background: rgba(255, 255, 255, 0.2);
            border: 1px solid rgba(255, 255, 255, 0.3);
            color: white;
            padding: 8px 16px;
            border-radius: 20px;
            cursor: pointer;
            font-size: 12px;
            transition: all 0.3s ease;
        }

        button:hover {
            background: rgba(255, 255, 255, 0.3);
        }

        button.active {
            background: rgba(74, 144, 226, 0.8);
        }

        .stats {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            font-size: 12px;
        }

        .stat {
            text-align: center;
        }

        .stat-value {
            font-size: 1.2em;
            font-weight: bold;
            color: #4a90e2;
        }

        /* æ—§ç‰ˆé›¨æ»´ç‰¹æ•ˆï¼ˆçº¿æ¡å¼ï¼‰ */
        .old-rain-effect {
            position: absolute;
            width: 100%;
            height: 100%;
            background: linear-gradient(180deg, transparent 0%, rgba(255,255,255,0.1) 50%, transparent 100%);
            background-size: 2px 20px;
            animation: oldRainFall 0.5s linear infinite;
            pointer-events: none;
        }

        .old-rain-light {
            opacity: 0.3;
            background-size: 1px 15px;
            animation-duration: 0.8s;
        }

        .old-rain-moderate {
            opacity: 0.5;
            background-size: 2px 25px;
            animation-duration: 0.4s;
        }

        .old-rain-heavy {
            opacity: 0.7;
            background-size: 3px 35px;
            animation-duration: 0.2s;
        }

        @keyframes oldRainFall {
            0% { transform: translateY(-100vh); }
            100% { transform: translateY(100vh); }
        }

        /* æ–°ç‰ˆä¼˜åŒ–é›¨æ»´ç‰¹æ•ˆ */
        .rain-effect-optimized {
            position: absolute;
            width: 100%;
            height: 100%;
            pointer-events: none;
            overflow: hidden;
        }

        .raindrop {
            position: absolute;
            width: 2px;
            height: 12px;
            background: linear-gradient(to bottom, 
                rgba(255, 255, 255, 0.9) 0%,
                rgba(255, 255, 255, 0.7) 30%,
                rgba(174, 194, 224, 0.5) 70%,
                rgba(174, 194, 224, 0.3) 100%);
            border-radius: 0 0 50% 50%;
            animation: raindropFall linear infinite;
            transform: translateZ(0);
            will-change: transform;
            box-shadow: 0 0 1px rgba(0, 0, 0, 0.1);
            filter: drop-shadow(0 0 0.5px rgba(0, 0, 0, 0.2));
        }

        .rain-light .raindrop {
            opacity: 0.6;
            width: 1.5px;
            height: 8px;
        }

        .rain-moderate .raindrop {
            opacity: 0.7;
            width: 2px;
            height: 12px;
        }

        .rain-heavy .raindrop {
            opacity: 0.8;
            width: 2.5px;
            height: 16px;
        }

        @keyframes raindropFall {
            0% {
                transform: translateY(-20px) translateZ(0);
                opacity: 0;
            }
            5% {
                opacity: 1;
            }
            95% {
                opacity: 1;
            }
            100% {
                transform: translateY(calc(100vh + 20px)) translateZ(0);
                opacity: 0;
            }
        }

        /* æ€§èƒ½ä¼˜åŒ– */
        .rain-effect-optimized,
        .raindrop {
            will-change: transform, opacity;
            transform: translateZ(0);
            backface-visibility: hidden;
            perspective: 1000px;
        }

        .weather-effects {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 1;
            overflow: hidden;
        }

        .performance-warning {
            background: rgba(255, 193, 7, 0.8);
            color: #000;
            padding: 10px;
            border-radius: 5px;
            margin-top: 10px;
            display: none;
        }

        .performance-warning.show {
            display: block;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- æ—§ç‰ˆç‰¹æ•ˆé¢æ¿ -->
        <div class="test-panel">
            <div class="weather-effects" id="oldEffects"></div>
            <div class="panel-header">
                <div class="panel-title">ğŸŒ§ï¸ æ—§ç‰ˆé›¨æ»´ç‰¹æ•ˆï¼ˆçº¿æ¡å¼ï¼‰</div>
                <div class="controls">
                    <button onclick="startOldRain('light')">å°é›¨</button>
                    <button onclick="startOldRain('moderate')">ä¸­é›¨</button>
                    <button onclick="startOldRain('heavy')">å¤§é›¨</button>
                    <button onclick="stopOldRain()">åœæ­¢</button>
                </div>
                <div class="stats">
                    <div class="stat">
                        <div class="stat-value" id="oldFps">--</div>
                        <div>FPS</div>
                    </div>
                    <div class="stat">
                        <div class="stat-value" id="oldElements">0</div>
                        <div>å…ƒç´ æ•°</div>
                    </div>
                    <div class="stat">
                        <div class="stat-value" id="oldMemory">--</div>
                        <div>å†…å­˜(MB)</div>
                    </div>
                </div>
                <div class="performance-warning" id="oldWarning">
                    âš ï¸ æ€§èƒ½è­¦å‘Šï¼šFPSä½äº30ï¼ŒCPU/GPUå ç”¨è¿‡é«˜ï¼
                </div>
            </div>
        </div>

        <!-- æ–°ç‰ˆç‰¹æ•ˆé¢æ¿ -->
        <div class="test-panel">
            <div class="weather-effects" id="newEffects"></div>
            <div class="panel-header">
                <div class="panel-title">âœ¨ æ–°ç‰ˆé›¨æ»´ç‰¹æ•ˆï¼ˆä¼˜åŒ–ç‰ˆï¼‰</div>
                <div class="controls">
                    <button onclick="startNewRain('light')">å°é›¨</button>
                    <button onclick="startNewRain('moderate')">ä¸­é›¨</button>
                    <button onclick="startNewRain('heavy')">å¤§é›¨</button>
                    <button onclick="stopNewRain()">åœæ­¢</button>
                </div>
                <div class="stats">
                    <div class="stat">
                        <div class="stat-value" id="newFps">--</div>
                        <div>FPS</div>
                    </div>
                    <div class="stat">
                        <div class="stat-value" id="newElements">0</div>
                        <div>å…ƒç´ æ•°</div>
                    </div>
                    <div class="stat">
                        <div class="stat-value" id="newMemory">--</div>
                        <div>å†…å­˜(MB)</div>
                    </div>
                </div>
                <div class="performance-warning" id="newWarning">
                    âš ï¸ æ€§èƒ½è­¦å‘Šï¼šFPSä½äº30ï¼ŒCPU/GPUå ç”¨è¿‡é«˜ï¼
                </div>
            </div>
        </div>
    </div>

    <script>
        class RainEffectTester {
            constructor() {
                this.oldContainer = document.getElementById('oldEffects');
                this.newContainer = document.getElementById('newEffects');
                this.oldEffect = null;
                this.newEffect = null;
                this.performanceLevel = this.detectPerformanceLevel();
                this.startMonitoring();
            }

            detectPerformanceLevel() {
                const isMobile = /Android|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
                const hardwareConcurrency = navigator.hardwareConcurrency || 2;
                const deviceMemory = navigator.deviceMemory || 2;
                
                let score = 0;
                score += isMobile ? 0 : 2;
                score += hardwareConcurrency >= 4 ? 2 : (hardwareConcurrency >= 2 ? 1 : 0);
                score += deviceMemory >= 4 ? 2 : (deviceMemory >= 2 ? 1 : 0);
                
                if (score >= 4) return 'high';
                if (score >= 2) return 'medium';
                return 'low';
            }

            startOldRain(intensity) {
                this.stopOldRain();
                
                const rainDiv = document.createElement('div');
                rainDiv.className = `old-rain-effect old-rain-${intensity}`;
                
                this.oldContainer.appendChild(rainDiv);
                this.oldEffect = rainDiv;
                
                document.getElementById('oldElements').textContent = '1';
            }

            stopOldRain() {
                this.oldContainer.innerHTML = '';
                this.oldEffect = null;
                document.getElementById('oldElements').textContent = '0';
            }

            startNewRain(intensity) {
                this.stopNewRain();
                
                const rainDiv = document.createElement('div');
                rainDiv.className = 'rain-effect-optimized';

                let dropCount;
                if (intensity === 'light') {
                    dropCount = this.performanceLevel === 'high' ? 30 : (this.performanceLevel === 'medium' ? 20 : 10);
                    rainDiv.classList.add('rain-light');
                } else if (intensity === 'heavy') {
                    dropCount = this.performanceLevel === 'high' ? 80 : (this.performanceLevel === 'medium' ? 50 : 25);
                    rainDiv.classList.add('rain-heavy');
                } else {
                    dropCount = this.performanceLevel === 'high' ? 50 : (this.performanceLevel === 'medium' ? 35 : 18);
                    rainDiv.classList.add('rain-moderate');
                }

                for (let i = 0; i < dropCount; i++) {
                    const drop = document.createElement('div');
                    drop.className = 'raindrop';
                    
                    drop.style.left = Math.random() * 100 + '%';
                    drop.style.animationDelay = Math.random() * 2 + 's';
                    
                    const baseDuration = intensity === 'heavy' ? 0.5 : 
                                        intensity === 'light' ? 1.2 : 0.8;
                    const performanceMultiplier = this.performanceLevel === 'low' ? 1.5 : 1;
                    drop.style.animationDuration = (baseDuration * performanceMultiplier + Math.random() * 0.3) + 's';
                    
                    rainDiv.appendChild(drop);
                }

                this.newContainer.appendChild(rainDiv);
                this.newEffect = rainDiv;
                
                document.getElementById('newElements').textContent = dropCount;
            }

            stopNewRain() {
                this.newContainer.innerHTML = '';
                this.newEffect = null;
                document.getElementById('newElements').textContent = '0';
            }

            startMonitoring() {
                let oldFrameCount = 0;
                let newFrameCount = 0;
                let lastTime = performance.now();
                
                const monitor = () => {
                    oldFrameCount++;
                    newFrameCount++;
                    const currentTime = performance.now();
                    
                    if (currentTime - lastTime >= 1000) {
                        const oldFps = oldFrameCount;
                        const newFps = newFrameCount;
                        oldFrameCount = 0;
                        newFrameCount = 0;
                        lastTime = currentTime;
                        
                        document.getElementById('oldFps').textContent = oldFps;
                        document.getElementById('newFps').textContent = newFps;
                        
                        // å†…å­˜ä½¿ç”¨æƒ…å†µ
                        if (performance.memory) {
                            const memoryMB = Math.round(performance.memory.usedJSHeapSize / 1024 / 1024);
                            document.getElementById('oldMemory').textContent = memoryMB;
                            document.getElementById('newMemory').textContent = memoryMB;
                        }
                        
                        // æ€§èƒ½è­¦å‘Š
                        const oldWarning = document.getElementById('oldWarning');
                        const newWarning = document.getElementById('newWarning');
                        
                        if (oldFps < 30 && this.oldEffect) {
                            oldWarning.classList.add('show');
                        } else {
                            oldWarning.classList.remove('show');
                        }
                        
                        if (newFps < 30 && this.newEffect) {
                            newWarning.classList.add('show');
                        } else {
                            newWarning.classList.remove('show');
                        }
                    }
                    
                    requestAnimationFrame(monitor);
                };
                
                requestAnimationFrame(monitor);
            }
        }

        const tester = new RainEffectTester();

        function startOldRain(intensity) {
            tester.startOldRain(intensity);
        }

        function stopOldRain() {
            tester.stopOldRain();
        }

        function startNewRain(intensity) {
            tester.startNewRain(intensity);
        }

        function stopNewRain() {
            tester.stopNewRain();
        }

        // æ˜¾ç¤ºè®¾å¤‡ä¿¡æ¯
        console.log('è®¾å¤‡æ€§èƒ½ç­‰çº§:', tester.performanceLevel);
        console.log('CPUæ ¸å¿ƒæ•°:', navigator.hardwareConcurrency);
        console.log('è®¾å¤‡å†…å­˜:', navigator.deviceMemory, 'GB');
        console.log('ç”¨æˆ·ä»£ç†:', navigator.userAgent);
    </script>
</body>
</html>
