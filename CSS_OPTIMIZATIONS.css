/* 
 * CSS性能优化建议
 * 解决代码审查中发现的CSS性能问题
 */

/* 1. 优化的CSS变量定义 - 移除未使用的变量 */
:root {
  /* 核心颜色系统 */
  --primary-color: #4A90E2;
  --text-primary: #2C3E50;
  --text-light: #BDC3C7;
  --bg-card: #FFFFFF;
  --border-color: #E1E8ED;
  
  /* 性能优化的液态玻璃系统 */
  --glass-bg: rgba(255, 255, 255, 0.1);
  --glass-border: rgba(255, 255, 255, 0.2);
  --glass-blur: blur(10px);
  --glass-radius: 12px;
  
  /* 优化的过渡动画 - 使用transform和opacity */
  --transition-fast: transform 0.2s ease, opacity 0.2s ease;
  --transition-medium: transform 0.3s ease, opacity 0.3s ease;
  
  /* 阴影优化 - 减少复杂度 */
  --shadow-light: 0 2px 8px rgba(0, 0, 0, 0.1);
  --shadow-medium: 0 4px 16px rgba(0, 0, 0, 0.15);
}

/* 2. 性能优化的基础样式 */
* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

/* 优化：使用will-change提示浏览器优化 */
.weather-card,
.modal-content,
.loading-spinner {
  will-change: transform, opacity;
}

/* 3. 优化的背景处理 - 避免重复定义 */
body {
  font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
  line-height: 1.6;
  color: var(--text-primary);
  min-height: 100vh;
  background-size: cover;
  background-position: center;
  background-repeat: no-repeat;
  background-attachment: fixed;
  transition: background-image 0.8s ease-in-out;
}

/* 时间背景 - 合并重复样式 */
body.time-day {
  background-image: url('/static/day.png');
}

body.time-night {
  background-image: url('/static/night.webp');
  /* 夜晚模式变量覆盖 */
  --glass-bg: rgba(255, 255, 255, 0.05);
  --glass-border: rgba(255, 255, 255, 0.15);
}

/* 4. 优化的液态玻璃卡片 - 减少重复代码 */
.glass-card {
  background: var(--glass-bg);
  backdrop-filter: var(--glass-blur);
  -webkit-backdrop-filter: var(--glass-blur);
  border: 1px solid var(--glass-border);
  border-radius: var(--glass-radius);
  box-shadow: var(--shadow-medium);
  transition: var(--transition-medium);
}

/* 应用到具体元素 */
.current-weather-card,
.hourly-forecast-card,
.daily-forecast-card,
.weather-tips-card {
  @extend .glass-card; /* 如果支持，或者直接应用类名 */
  padding: 1.5rem;
  margin-bottom: 1.5rem;
}

/* 5. 性能优化的动画 - 只使用transform和opacity */
@keyframes optimizedSlideIn {
  0% {
    opacity: 0;
    transform: translateY(20px);
  }
  100% {
    opacity: 1;
    transform: translateY(0);
  }
}

@keyframes optimizedSpin {
  0% { transform: rotate(0deg); }
  100% { transform: rotate(360deg); }
}

/* 6. 优化的悬停效果 - 避免重排 */
.glass-card:hover {
  transform: translateY(-2px);
  opacity: 0.95;
  box-shadow: var(--shadow-medium), 0 8px 32px rgba(0, 0, 0, 0.1);
}

/* 7. 响应式优化 - 减少媒体查询重复 */
.responsive-grid {
  display: grid;
  gap: 1.5rem;
  grid-template-columns: 1fr;
}

@media (min-width: 768px) {
  .responsive-grid {
    grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
    gap: 2rem;
  }
}

/* 8. 移动端性能优化 */
@media (max-width: 767px) {
  /* 减少移动端的模糊效果以提升性能 */
  .glass-card {
    backdrop-filter: blur(5px);
    -webkit-backdrop-filter: blur(5px);
  }
  
  /* 简化移动端动画 */
  * {
    animation-duration: 0.3s !important;
  }
}

/* 9. 减少动画的性能影响 */
@media (prefers-reduced-motion: reduce) {
  * {
    animation-duration: 0.01ms !important;
    animation-iteration-count: 1 !important;
    transition-duration: 0.01ms !important;
  }
}

/* 10. 优化的加载状态 */
.loading-spinner-optimized {
  width: 40px;
  height: 40px;
  border: 3px solid rgba(255, 255, 255, 0.3);
  border-top: 3px solid white;
  border-radius: 50%;
  animation: optimizedSpin 1s linear infinite;
  margin: 0 auto 1rem;
}

/* 11. 内容可见性优化 */
.weather-content {
  content-visibility: auto;
  contain-intrinsic-size: 0 500px;
}

/* 12. 字体加载优化 */
@font-face {
  font-family: 'Inter';
  font-display: swap; /* 优化字体加载 */
  src: url('/static/fonts/inter.woff2') format('woff2');
}

/* 13. 图片优化提示 */
.weather-icon {
  font-size: 4rem;
  /* 使用CSS而不是图片可以提升性能 */
  text-rendering: optimizeSpeed;
}

/* 14. 滚动性能优化 */
.scrollable-content {
  overflow-y: auto;
  -webkit-overflow-scrolling: touch; /* iOS平滑滚动 */
  scroll-behavior: smooth;
}

/* 15. GPU加速提示 */
.gpu-accelerated {
  transform: translateZ(0); /* 强制GPU加速 */
  backface-visibility: hidden;
  perspective: 1000px;
}

/* 16. 优化的模态框 */
.modal-overlay {
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background: rgba(0, 0, 0, 0.5);
  backdrop-filter: blur(5px);
  -webkit-backdrop-filter: blur(5px);
  display: flex;
  align-items: center;
  justify-content: center;
  z-index: 1000;
  opacity: 0;
  visibility: hidden;
  transition: var(--transition-medium);
}

.modal-overlay.active {
  opacity: 1;
  visibility: visible;
}

.modal-content-optimized {
  background: var(--glass-bg);
  backdrop-filter: var(--glass-blur);
  -webkit-backdrop-filter: var(--glass-blur);
  border: 1px solid var(--glass-border);
  border-radius: var(--glass-radius);
  padding: 2rem;
  max-width: 90vw;
  max-height: 90vh;
  overflow-y: auto;
  transform: scale(0.9);
  transition: var(--transition-medium);
}

.modal-overlay.active .modal-content-optimized {
  transform: scale(1);
}

/* 17. 性能监控样式 */
.performance-indicator {
  position: fixed;
  top: 10px;
  right: 10px;
  background: rgba(0, 0, 0, 0.8);
  color: white;
  padding: 0.5rem;
  border-radius: 4px;
  font-size: 0.8rem;
  z-index: 9999;
  display: none; /* 仅在开发环境显示 */
}

.performance-indicator.show {
  display: block;
}

/* 18. 关键CSS内联建议 */
/*
以下样式应该内联到HTML中以提升首屏加载速度：
- 基础布局样式
- 加载状态样式
- 关键路径样式
*/

.critical-styles {
  /* 这些样式应该内联 */
  display: flex;
  flex-direction: column;
  min-height: 100vh;
  font-family: system-ui, -apple-system, sans-serif;
}

/* 19. 打印样式优化 */
@media print {
  .modal-overlay,
  .loading-spinner,
  .performance-indicator {
    display: none !important;
  }
  
  .glass-card {
    background: white !important;
    backdrop-filter: none !important;
    border: 1px solid #ccc !important;
  }
}

/* 20. 高对比度模式支持 */
@media (prefers-contrast: high) {
  .glass-card {
    background: rgba(255, 255, 255, 0.9);
    border: 2px solid #000;
  }
  
  body.time-night .glass-card {
    background: rgba(0, 0, 0, 0.9);
    color: white;
    border: 2px solid #fff;
  }
}
